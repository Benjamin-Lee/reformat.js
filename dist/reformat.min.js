function getGIs(a){for(var b="",c=0;c<a.length;c++)"gi|"==a[c].name.substring(0,3)&&(b+=a[c].name.substring(3).split("|")[0],b+="\n");return b}function getAccessionVersion(a){for(var b="",c=0;c<a.length;c++){var d=a[c].name.split(/\s/g);d[0].toUpperCase().match("GI")||(b+=d[0],b+="\n")}return b}function chunkString(a,b){for(var e,c=Math.ceil(a.length/b),d=new Array(c),f=0;f<c;f++)e=f*b,d[f]=a.substring(e,e+b);return d}function _contains(a,b){return"".indexOf.call(a,b,0)!==-1}function clustalParser(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;if(n=[],i="[object Array]"===Object.prototype.toString.call(a)?a:a.split("\n"),i[0].slice(0,6)===!1)throw new Error("Invalid CLUSTAL Header");for(d=0,b=1,m=0;d<i.length;)d++,h=i[d],null!=h&&0!==h.length&&0!==h.trim().length?_contains(h,"*")||(1===b&&(m=0,b=0),l=/^(?:\s*)(\S+)(?:\s+)(\S+)(?:\s*)(\d*)(?:\s*|$)/g,j=l.exec(h),null!=j&&(g=j[1],f=g,o=j[2],m>=n.length?(k=getMeta(g),g=k.name,c=new model(o,g,m),c.untrimmed=f,c.ids=k.ids||{},c.details=k.details||{},e=Object.keys(c.ids),e.length>0&&(c.id=c.ids[e[0]]),n.push(c)):n[m].seq+=o,m++)):b=1;return n}function getMeta(a){var d,g,b=!1,c=!1,e={},f={},h=a.split(" ");if(h.length>=1?(b=h.shift(),c=h.join(" ")):b=a,d=b,c){var i=c.split("=");if(i.length>1){var j,k;i.length-1;i.forEach(function(a){a=a.trim();var c,b=a.split(" ");if(b.length>1?(k=b.pop(),c=b.join(" ")):c=a,j){var d=j.toLowerCase();f[d]=c}else g=c;j=k})}else g=i.shift()}var o={name:d,ids:e,details:f};return g&&(o.desc=g),o}function model(a,b,c){this.seq=a,this.name=b,this.id=c,this.ids={}}function validateFasta(a){if(!a)return!1;var b=a.split("\n");if(!b[0].startsWith("#")&&b[0].startsWith(">")){if(!a.startsWith(">"))return!1;if(a.indexOf(">")==-1)return!1;for(var c=a.split(">"),d=1;d<c.length;d++){if(";"==c[d].charAt(4))return!1;var e=">"+c[d];e=e.trim();var f=e.split("\n");if(">"==e[0]&&f.splice(0,1),e=f.join("").trim(),/[^\-\\ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(e))return!1}return!0}return!1}function validateClustal(a){if(!a)return!1;var b,c,d,e,f,g;a=a.split("\n"),c=!1;var h=clustalParser(a);for(d=0,e=a.length;d<e;d++)if(g=a[d],!g.match(/^\s*$/))if(c===!0){if(g=g.trim(),f=g.split(/\s+/g),2!==f.length&&3!==f.length)return console.log("Each line has to include name/sequence and optional length"),!1;if(f[1].length>60)return console.log("More than 60 sequence symbols in one line"),!1}else{if(b=g.trim().replace(" ",""),!b.startsWith("CLUSTAL"))return console.log("No CLUSTAL Header"),!1;for(var i=1;i<h.length;i++){if(h[i].seq.length!==h[i-1].seq.length)return console.log("input is not an alignment"),!1;if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(h[i].seq))throw new Error("Alignment contains invalid symbols.")}c=!0}return!0}function aminoCount(a){var b;b=new Uint32Array(91);for(var c=0;c<b.byteLength;c++)b[a.charCodeAt(c)]+=1;return b}function lowerCase(a){for(var b=0;b<a.length;b++)a[b].seq=a[b].seq.toLowerCase();return a}function upperCase(a){for(var b=0;b<a.length;b++)a[b].seq=a[b].seq.toUpperCase();return a}function conservation(a){}function getNumberOfFastaSeqs(a){var b=readFastaText(a);return b.length}function addSpaceEveryNChars(a,b){var d,e,c="";for(d=0,e=a.length;d<e;d+=b)c+=a.substr(d,b),c+=" ";return c}function validateAlignment(a){if(!a)throw new Error("No sequences.");if(a.length<2)throw new Error("Alignment needs at least two sequences");for(var b=a[0].seq.length,c=0;c<a.length;c++){if(a[c].seq.length!==b)throw new Error("Sequences are required to have the same length.");if(""==a[c].seq)throw new Error("Alignment contains an empty sequence.")}return console.log("this is an alignment"),!0}function json2fasta(a){for(var b="",c=0;c<a.length;c++)b+=">",b+=a[c].name,b+="\n",b+=formatLongSeq(a[c].seq,60),b+="\n";return b}function fasta2json(a){for(var d,b=a.split("\n"),b=b.filter(Boolean),c=[],e=0;e<b.length;){for(d={},d.name="",b[e].startsWith(">")&&(d.name=b[e].substring(1)),e++,d.seq="";e<b.length&&!b[e].startsWith(">");)b[e].startsWith(";")||(d.seq+=b[e]),e++;c.push(d)}return c}function validatePhylip(a){if(!a)return!1;var b,c,d,e;if(b=a.split("\n"),b=b.filter(Boolean),c=b[0].match(/\S+/g),b[0].startsWith(" ")||b[0].startsWith("\t")){if(d=c[0],e=c[1],c.length<2||d<1||e<1||parseInt(d)<=0||parseInt(e)<=0)throw new Error("Incorrect header.");if(b.shift(),b.length%d!=0)return!1;for(var i=[],j=0;j<d;j++)b[j]=b[j].replace(/\s/g,""),i[j]=b[j].substring(10);for(var j=d,k=0;j<b.length&&b.length>d;j++,k++)j%d==0&&(k=0),b[j]=b[j].replace(/\s/g,""),i[k]+=b[j];for(var j=0;j<d;j++){if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(i[j]))throw new Error("Alignment contains invalid symbols.");if(i[j].length!=e)throw new Error("Number of sequence does not match with the header.")}return!0}return!1}function json2phylip(a){if(!a)return!1;var c,d,e,b="";c=a.length,d=a[0].seq.length,b+="\t",b+=c,b+="\t",b+=d;for(var f=0;f<c;f++){if(b+="\n",b+=a[f].name.substring(0,10),b+=" ",a[f].name.substring(0,10).length<10)for(var g=0;g<10-a[f].name.substring(0,9).length;g++)b+=" ";e=a[f].seq.match(/.{1,60}/g),b+=addSpaceEveryNChars(e[0],10)}for(var g=1;g<e.length;g++){b+="\n\n";for(var f=0;f<c;f++)e=a[f].seq.match(/.{1,60}/g),b+="           ",b+=addSpaceEveryNChars(e[g],10),b+="\n"}return b+="\n",b+="\n"}function phylip2json(a){if(!a)return!1;var b,c,d,e=[],f={};b=a.split("\n"),b=b.filter(Boolean),c=b[0].match(/\S+/g),d=c[0],b.shift();for(var g=0;g<d;g++){var f={};b[g]=b[g].replace(/\s/g,""),f.name=b[g].substring(0,9),f.seq=b[g].substring(10),e.push(f)}for(var g=d,h=0;g<b.length;g++,h++)g%d==0&&(h=0),b[g]=b[g].replace(/\s/g,""),e[h].seq+=b[g];return e}function validateStockholm(a){var b,c,d,e=[];if(!a)return!1;if(b=a.split("\n"),b[0].startsWith("# STOCKHOLM 1.0")&&b.length>1){b=b.filter(Boolean);for(var f=1;f<b.length&&!b[f].startsWith("//");f++)if(!b[f].startsWith("#")){if(c=b[f].split(/\s/g),c=c.filter(Boolean),c.length<2)throw new Error("Sequence or sequence name invalid.");if(d={},d.seq=c[1],/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(d.seq))throw new Error("Alignment contains invalid symbols.");e.push(d)}return!0}return!1}function json2stockholm(a){var b="";b+="# STOCKHOLM 1.0",b+="\n",b+="#GF SQ "+a.length,b+="\n";for(var c=0;c<a.length;c++)b+="#GF "+a[c].name.replace(/\s/g,"")+" DE "+a[c].name,b+="\n",b+=a[c].name.replace(/\s/g,""),b+=" \t",b+=a[c].seq,b+="\n";return b}function stockholm2json(a){var b,c,e,d=[];b=a.split("\n"),b=b.filter(Boolean);for(var f=0;f<b.length;f++)if(!b[f].startsWith("#")){if(b[f].startsWith("//"))break;c={},c.seq="",c.name="",e=b[f].split(/\s/g),e=e.filter(Boolean),c.name=e[0],c.seq=e[1],d.push(c)}return d}function clustal2json(a){if(!a)return!1;var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(i="[object Array]"===Object.prototype.toString.call(a)?a:a.split("\n"),n=[],d=0,b=1,m=0;d<i.length;)d++,h=i[d],null!=h&&0!==h.length&&0!==h.trim().length?_contains(h,"*")||(1===b&&(m=0,b=0),l=/^(?:\s*)(\S+)(?:\s+)(\S+)(?:\s*)(\d*)(?:\s*|$)/g,j=l.exec(h),null!=j?(g=j[1],f=g,o=j[2],m>=n.length?(k=getMeta(g),g=k.name,c=new model(o,g,m),c.untrimmed=f,c.ids=k.ids||{},c.details=k.details||{},e=Object.keys(c.ids),e.length>0&&(c.id=c.ids[e[0]]),n.push(c)):n[m].seq+=o,m++):console.log("clustal parse error")):b=1;return n}function json2clustal(a){if(!a)return!1;var b=[],c=0,d=0;for(b+="CLUSTAL multiple sequence alignment",b+="\n\n";d<Math.trunc(a[c].seq.length/60)+1;d++){for(;c<a.length;c++)b+=a[c].name.replace(/\s/g,""),b+="\t",b+=chunkString(a[c].seq,60)[d],b+="\n";b+="\n\n",c=0}return b+="\n"}function a3m2json(a){for(var c,d,e,f,b=a.split("\n"),g=0;g<b.length;g++)(b[g].match(/>/g)||[]).length>1&&(b[g]=b[g].replace(/(?!^)>/g,""));for(a=b.join("\n"),d=a.split(">"),f=[],e=1;e<d.length;e++)c={},c.name=readA3mLine(d[e]).name,c.seq=readA3mLine(d[e]).seq,f.push(c);return f}function json2a3m(a){for(var b="",c=0;c<a.length;c++)b+=">",b+=a[c].name,b+="\n",b+=formatLongSeq(a[c].seq.split(".").join("")),b+="\n";return b}function validatea3m(a){if(!a)return!1;if(!validateFasta(a)){var b=a.split("\n");b=b.filter(Boolean);for(var c=fasta2json(a),d=0;d<c.length;d++){if(!b[d].startsWith(">"))return!1;if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(c[d].seq))return!1;if(c[d].seq.indexOf(".")>-1)return!0}}return!1}function pir2json(a){if(!a)return!1;for(var d,b=a.split("\n"),b=b.filter(Boolean),c=[],e=0;e<b.length;){for(d={},d.name="",b[e].startsWith(">")&&(d.name=b[e].substring(1),d.description+=b[+e+1]),e++,e++,d.seq="";e<b.length&&!b[e].startsWith(">");)b[e].startsWith(";")||(d.seq+=b[e].slice(0,-1)),e++;c.push(d)}return c}function json2pir(a){for(var b="",c=0;c<a.length;c++)b+=">XX;",b+=a[c].name,b+="\n",a[c].description?(b+=a[c].description,b+="\n"):(b+="No description.",b+="\n"),b+=formatLongSeq(a[c].seq,60),b+="*",b+="\n";return b}function validatePir(a){if(!a)return!1;for(var b=pir2json(a),c=0;c<b.length;c++){if(";"!=b[c].name.charAt(2))return!1;if(/[^\-\\.\\*ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(b[c].seq))throw new Error("Alignment contains invalid symbols.")}for(var d=a.split(">"),d=d.filter(Boolean),c=0;c<d.length;c++)if(d[c]=d[c].replace(/\s/g,""),!d[c].endsWith("*"))return!1;return!0}function formatLongSeq(a,b){var c,d="";c=a.match(/.{1,60}/g);for(var e=0;e<c.length;e++)d+=c[e],e!=c.length-1&&(d+="\n");return d}function validateEMBL(a){if(!a)return!1;var b,c;if(b=a.split("\n"),b=b.filter(Boolean),b[0].startsWith("ID")&&b[b.length-1].endsWith("//")){c=embl2json(a);for(var f=0;f<c.length;f++){if(""==c[f].seq)return!1;if(""==c[f].name)return!1;if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(c[f].seq))throw new Error("Alignment contains invalid symbols.")}return!0}return!1}function embl2json(a){if(!a)return!1;var b,c=[],d=a.split("\n");d=d.filter(Boolean);for(var e=0;e<d.length;e++){for(b={};+e+1<d.length&&!d[+e+1].startsWith("ID");){if(d[e].startsWith("ID")&&(b.name="",b.name+=d[e].substring(5)),d[e].startsWith("DE")&&(b.description="",b.description+=d[e].substring(5)),d[e].startsWith("SQ"))for(b.seq="";+e+1<d.length&&!d[+e+1].startsWith("//");)e++,b.seq+=d[e].replace(/\s/g,"").replace(/[0-9]/g,"").toUpperCase();e++}c.push(b)}return c}function json2embl(a){for(var c,b="",d=0;d<a.length;d++){b+="ID   ",b+=a[d].name.split(/\s/g)[0]+"; ; ; ; ; "+a[d].seq.length+" BP.",b+="\n",b+="XX",b+="\n";var e=a[d].name.split(/\s/g);e.shift(),e=e.join(" "),(""!=e||a[d].description)&&(b+="DE   ",b+=e,a[d].description&&(b+=" "+a[d].description),b+="\n",b+="XX",b+="\n"),c=aminoCount(a[d].seq),b+="SQ   Sequence "+a[d].seq.length+" BP; ",b+=c["A".charCodeAt()]+" A; ",b+=c["C".charCodeAt()]+" C; ",b+=c["G".charCodeAt()]+" G; ",b+=c["T".charCodeAt()]+" T; ";for(var f=0,g=0;g<c.length;g++)g!="A".charCodeAt()&&g!="C".charCodeAt()&&g!="G".charCodeAt()&&g!="T".charCodeAt()&&(f+=c[g]);b+=f+" others; ",b+="\n",b+=formatEmblSeq(a[d].seq).toLowerCase(),b+="\n",b+="//",b+="\n"}return b}function formatEmblSeq(a){var b,d,c="";b=a.match(/.{1,60}/g),d=0;for(var e=0;e<b.length;e++){c+="     "+addSpaceEveryNChars(b[e],10);for(var f=80-b[e].length-5-(d+b[e].length).toString().length-(""+(b[e].length-1))[0],g=0;g<f;g++)c+=" ";d+=b[e].length,c+=d,e!=b.length-1&&(c+="\n")}return c}function validateNexus(a){if(!a)return!1;var b,c,d,e=a.split("\n");if(e=e.filter(Boolean),!a.startsWith("#NEXUS"))return!1;if(!e[1].toUpperCase().startsWith("BEGIN"))return!1;if(!e[e.length-1].toUpperCase().startsWith("END;"))return!1;b=nexus2json(a);var f=e[2].toUpperCase().replace("NTAX="," ").replace("DIMENSIONS","").replace("NCHAR="," ").replace(";"," ");if(c=f.split(/\s/g).filter(Boolean)[0],d=f.split(/\s/g).filter(Boolean)[1],c!=b.length)throw new Error("Number of sequences does not match with the header.");for(var g=0;g<b.length;g++){if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(b[g].seq))throw new Error("Sequence contains invalid symbols.");if(d!=b[g].seq.length)throw new Error("Number of sequences does not match with the header.")}for(var g=0;g<b.length;g++){if(b[g].name="")return!1;if(b[g].seq="")return!1}return!0}function nexus2json(a){if(!a)return!1;var b,c=[],d=a.split("\n"),e=[];d=d.filter(Boolean),d.shift();for(var f=0;f<d.length;f++)if(d[f].toUpperCase().startsWith("MATRIX")){for(;+f+1<d.length&&!d[+f+1].startsWith(";");)b={},f++,b.name=d[f].split(/\s/g)[0],e=d[f].split(/\s/g),e.shift(),e.filter(Boolean),b.seq=e.join("").replace(/\?/g,"-").toUpperCase(),c.push(b);return c}}function json2nexus(a){var b="";b+="#NEXUS",b+="\n",b+="Begin data;",b+="\n",b+="Dimensions ntax="+a.length+" nchar="+a[0].seq.length+";",b+="\n",b+="format datatype="+typeOfSequence(a)+" missing=? gap= -;",b+="\n",b+="Matrix",b+="\n";for(var c=0;c<a.length;c++)b+=a[c].name.replace(/\s/g,""),b+="\t",b+=a[c].seq.toLowerCase(),b+="\n";return b+=";",b+="\n",b+="End;"}function validateGenbank(a){if(!a)return!1;var b,c=a.split("\n");if(c=c.filter(Boolean),!a.toUpperCase().startsWith("LOCUS"))return!1;if(!c[c.length-1].toUpperCase().replace(/\s/g,"").endsWith("//"))return!1;b=genbank2json(a);for(var d=0;d<b.length;d++){if(/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(b[d].seq))throw new Error("Sequence contains invalid symbols.");if(b[d].name="")return!1;if(b[d].seq="")return!1}return!0}function genbank2json(a){if(!a)return!1;var b,f,c=[],g=a.split("\n");g=g.filter(Boolean);for(var h=0;h<g.length;h++)if(b={},b.name="",b.seq="",b.description="",b.accession="",g[h].toUpperCase().startsWith("ACCESSION")&&(b.accession=" "+g[h].replace("ACCESSION","").trim()),g[h].toUpperCase().startsWith("DEFINITION")&&(f=" "+g[h].replace("DEFINITION","").trim()),g[h].replace(" ","").toUpperCase().startsWith("ORIGIN")){for(;+h+1<g.length&&!g[+h+1].startsWith("//");)h++,b.seq+=g[h].replace(/\s/g,"").replace(/[0-9]/g,"").toUpperCase();b.name+=(b.accession+" "+f).trim(),h++,c.push(b)}return c}function json2genbank(a){for(var b="",c=0;c<a.length;c++){b+="LOCUS\t\t\t\t\t\t"+a[c].seq.length+" bp\t\t\t"+typeOfSequence(a[c].seq),b+="\n",b+="DEFINITION\t\t",b+=a[c].name,b+="\n",b+="ACCESSION\t\t",b+=a[c].accession?a[c].accession:a[c].name.substring(0,10),b+="\n",b+="VERSION\t\t",b+="\n",b+="KEYWORDS\t\t",b+="\n",b+="SOURCE\t\t",b+="\n",b+="ORGANISM\t\tLocation/Qualifiers",b+="\n",b+="ORIGIN",b+="\n";for(var d=a[c].seq.toLowerCase().match(/.{1,60}/g),e=0,f=0;f<d.length;f++){e=d[f].length+e;for(var g=0;g<9-e.toString().length;g++)b+=" ";b+=e,b+=" ",b+=addSpaceEveryNChars(d[f],10),b+="\n"}b+="//",b+="\n"}return b}function typeOfSequence(a){return/[^\-\\.AGUC\s]/i.test(a[0].seq)?/[^\-\\.AGTC\s]/i.test(a[0].seq)?/[^\-\\.ABCDEFGHIKLMNPQRSTUVWXYZ\s]/i.test(a[0].seq)?"undefined":"Protein":"DNA":"RNA"}function searchRegex(a,b,c){if(a&&b){var d,e,f,g,h=[];e=new RegExp(b,c);for(var i=0;i<a.length;i++)if(null!=a[i].seq.match(e)){var j={};f=0,g=0,d=a[i].seq.match(e);for(var k=[],l=0;l<d.length;l++){var m={};f=a[i].seq.indexOf(d[l],g+1),g=a[i].seq.indexOf(d[l],g+1)+d[l].length-1,m.endPos=f,m.startPos=g,k.push(m)}j.seq=a[i].seq,j.name=a[i].name,j.hit=k,h.push(j)}return h}}function consensus(a){if(!validateAlignment(a))return void console.log("not an alignment");for(var b=[],c=0;c<a[0].seq.length;c++)b.push("");for(var d="",c=0;c<a.length;c++)for(var e=0;e<a[c].seq.length;e++)b[e]+=a[c].seq[e];for(var f=0;f<b.length;f++)d+=getMax(b[f]);return d}function getFormat(a){return validateFasta(a)?"Fasta":validatea3m(a)?"A3M":validatePhylip(a)?"Phylip":validateClustal(a)?"Clustal":validateEMBL(a)?"EMBL":validateGenbank(a)?"Genbank":validateNexus(a)?"NEXUS":validatePir(a)?"PIR":validateStockholm(a)?"Stockholm":""}var getMax=function(a){var b=0,c="";return a.split("").forEach(function(d){a.split(d).length>b&&(b=a.split(d).length,c=d)}),c};!function(a){a.fn.validate=function(a){var b=this.val(),c=getFormat(b);return c.toUpperCase()==a.toUpperCase()},a.fn.reformat=function(a,b,c){var d=this.val(),e=getFormat(d);a=a.toUpperCase();var f=[],g="";switch(e){case"Fasta":f=fasta2json(d);break;case"A3M":f=a3m2json(d);break;case"Phylip":f=phylip2json(d);break;case"Clustal":f=clustal2json(d);break;case"Nexus":f=nexus2json(d);break;case"EMBL":f=embl2json(d);break;case"Genbank":f=genbank2json(d);break;case"PIR":f=pir2json(d);break;case"Stockholm":f=stockholm2json(d);break;default:f=null}switch(a){case"FASTA":g=json2fasta(f);break;case"A3M":g=json2a3m(f);break;case"PHYLIP":g=json2phylip(f);break;case"CLUSTAL":g=json2clustal(f);break;case"NEXUS":g=json2nexus(f);break;case"EMBL":g=json2embl(f);break;case"GENBANK":g=json2genbank(f);break;case"PIR":g=json2pir(f);break;case"STOCKHOLM":g=json2stockholm(f);break;case"UC":g=upperCase(f);break;case"LC":g=lowerCase(f);break;case"GETGIS":g=getGIs(f);break;case"GETACCESSIONS":g=getAccessionVersion(f);break;case"REGEX":g=searchRegex(f,b,c);break;case"CONSENSUS":g=consensus(f);break;case"DETECT":g=e;break;case"PROSITE":g=searchProsite(f,b);break;default:g=null}return g}}(jQuery);